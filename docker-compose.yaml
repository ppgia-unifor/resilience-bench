version: '3.4'

services:
  cockatiel:
    build:
      context: ./clients/cockatiel
    container_name: cockatiel
    depends_on:
      - server

  scheduler:
    build: 
      context: ./scheduler
    container_name: scheduler
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./samples/config-cockatiel.json:/opt/app/conf/conf.json
      - ./results:/opt/app/resilience-tests
      - /home/vagrant/.aws/credentials:/root/.aws/credentials
    environment:
      - AWS_BUCKET_NAME=phd-carlos-results
      - AWS_OUTPUT_PATH=matheus-experiments
      - CONFIG_FILE=/opt/app/conf/conf.json
      - ENVOY_FAULT_INJECTION_PATH=/opt/app/fault-injection
      - DOCKER_HOST=/var/run/docker.sock
      - TIME_ZONE=America/Sao_Paulo
    depends_on:
      - server

  server:
    build:
      context: server
    container_name: server
    ports:
      - 9901:9901
      - 9211:9211
    volumes:
      - ./runtime:/srv/runtime
